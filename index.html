<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <title>Raspberry Pi Zero – WebXR с GLB модел (debug)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #debug {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 6px 10px;
      background: rgba(0,0,0,0.7);
      color: #00ff00;
      font-family: monospace;
      font-size: 13px;
      white-space: pre-line;
      z-index: 10;
    }
  </style>
</head>
<body>
<div id="debug">Старт на страницата...</div>

<script type="module">
  const debug = document.getElementById('debug');
  debug.textContent = 'JS модулът се зареди...';

  // Импорти – същият стил като в работещия пример
  import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
  import { XRButton } from 'https://unpkg.com/three@0.160.0/examples/jsm/webxr/XRButton.js';
  import { GLTFLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';

  let scene, camera, renderer;

  init();
  animate();

  function init() {
    debug.textContent = 'Инициализиране на сцена...';

    // Сцена
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x101010);

    // Камера на височина ~1.6 m (ръст на човек)
    camera = new THREE.PerspectiveCamera(
      70,
      window.innerWidth / window.innerHeight,
      0.01,
      20
    );
    camera.position.set(0, 1.6, 0);

    // Рендерер + WebXR
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.xr.enabled = true;
    document.body.appendChild(renderer.domElement);
    document.body.appendChild(XRButton.createButton(renderer));

    // Светлини
    const hemi = new THREE.HemisphereLight(0xffffff, 0x222222, 1.2);
    scene.add(hemi);

    const dirLight = new THREE.DirectionalLight(0xffffff, 1.0);
    dirLight.position.set(2, 3, 1);
    scene.add(dirLight);

    // Под (решетка) – за референция
    const grid = new THREE.GridHelper(2, 20, 0x555555, 0x333333);
    grid.position.y = 0;
    scene.add(grid);

    // DEBUG куб – да сме сигурни, че НЕ е черен екран
    const debugCube = new THREE.Mesh(
      new THREE.BoxGeometry(0.1, 0.1, 0.1),
      new THREE.MeshStandardMaterial({ color: 0xffcc00 })
    );
    debugCube.position.set(0, 1.6, -0.6); // точно пред очите
    scene.add(debugCube);

    debug.textContent = 'Сцена и светлини са готови.\nОпит за зареждане на model1.glb...';

    // Зареждане на GLB модела
    const loader = new GLTFLoader();
    loader.load(
      'model1.glb',   // Твоят файл – както ти каза, така се казва
      (gltf) => {
        const model = gltf.scene;

        // Позиция: пред теб, малко под нивото на очите
        model.position.set(0, 1.2, -0.8);

        // СКАЛА:
        // Ако моделът е в милиметри → 0.001
        // Ако е в метри → пробвай 1.0
        model.scale.set(0.01, 0.01, 0.01);

        scene.add(model);
        debug.textContent = 'model1.glb е зареден успешно.\nТрябва да виждаш решетка, жълто кубче и платката.';
      },
      undefined,
      (err) => {
        console.error('Грешка при зареждане на model1.glb:', err);
        debug.textContent = 'Грешка при зареждане на model1.glb.\nВиж конзолата на браузъра.\n' + (err.message || '');
      }
    );

    // Resize
    window.addEventListener('resize', onWindowResize);
  }

  function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }

  function animate() {
    renderer.setAnimationLoop(render);
  }

  function render(time) {
    renderer.render(scene, camera);
  }
</script>
</body>
</html>
